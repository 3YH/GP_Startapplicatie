<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../my-app/shared-styles.html">
<link rel="import" href="../app-globals/app-globals.html">
<dom-module id="my-rooster-student">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      span {
        @apply --paper-font-body1;
      }

     .content-card p, b{
       padding-left: 15px;
       margin: 2px 0;
     }

     .my-button{
       min-width: 145px;
       background-color: #00A1E1;
       color:#fff;
       margin: 10px;
     }

     .paper-toast{
      --paper-toast-background-color: #00A1E1;
      --paper-toast-color: white;
     }
    </style>
    <paper-dialog with-backdrop id="dialog">
      <div class="dialog-header">
        <div class="icon">
          <iron-icon icon="icons:query-builder"></iron-icon>
        </div>
        <div class="title">
          <h1>OO Design & Construction_Werkcollege</h1>
          <h3>Werkcollege</h3>
        </div>
        <iron-icon class="close" icon="icons:clear" dialog-dismiss></iron-icon>
      </div>
      <div class="date-header">
        <h2>Dinsdag 20 Februari 2018
          <span>09:00 - 13:00</span>
        </h2>
      </div>
      <div class="dialog-content">
        <div class="content-left">
          <h3>Lesinformatie</h3>
          <div class="content-card">
            <b>Cursusode</b>
            <p>TICT-V1OODC-15_2017</p>
            <b>Lokaalnummer(s)</b>
            <p>DL200-3.83</p>
            <b>Docent(en)</b>
            <p>Dietske.Obbink@hu.nl</p>
            <b>Groep(en)</b>
            <p>TICT-SIE-V1D</p>
            <b>Opmerking</b>
            <p>TICT-V1OODC-15_Werkcollege</p>
          </div>
        </div>
        <div class="content-right">
          <h3>Absentie</h3>
          <div class="content-card">
            <paper-button
              class="my-button"
              id="button_afwezig_melden"
              on-click="_verander_status_aanwezigheid"
              raised>
                Afwezig melden
            </paper-button>
            <paper-button
              class="my-button"
              id="button_ziek_melden"
              on-click="_verander_status_gezondheid"
              raised>
                Ziek melden
            </paper-button>
          </div>
          <paper-toast class="paper-toast" id="ziekmelding" text="Je bent nu ziek gemeld."></paper-toast>
          <paper-toast class="paper-toast" id="betermelding" text="Je bent nu beter gemeld."></paper-toast>
          <paper-toast class="paper-toast" id="afwezigmelding" text="Je bent nu afwezig gemeld."></paper-toast>
          <paper-toast class="paper-toast" id="aanwezigmelding" text="Je bent nu aanwezig gemeld."></paper-toast>
        </div>
      </div>
    </paper-dialog>


    <iron-ajax
            id="ajax_rooster"
            method="POST"
            url="/rooster/ophalen"
            handle-as="json"
            on-response="_ophalen_rooster_response_handler"
            debounce-duration="1000"
            last-response="{{response}}"></iron-ajax>

    <app-globals id="globalvars"></app-globals>

    <scheduler-component on-event-click="toggleDialog" default-view="agendaWeek" header='{"left":"prev,next,today","right":"month,agendaWeek,agendaDay,listWeek"}'
      height=100% min-time="07:00:00" max-time="20:00:00" events$='{{events}}'>
    </scheduler-component>
  </template>

  <script>
    (function () {

        console.log("!!!");
      'use strict';
      /* _xxxx private              : geen external data binding      - geen notify
         _c_xx private constant     : geen external binding, constant - geen notify
         c_xx  public constant      : one way external databinding [[c_xx]] - geen notify nodig
         xxxx  public               : two way external databinding {{xxxx}} - notify nodig
      */
      Polymer({
        is: 'my-rooster-student',


        properties: {
          rol: {
            type: String,
              value: 'undefined',
              observer: '_activeChanged',
            notify: true,
          },
          passthrough: {
              type: String,
              value: 'leeeeg',
              observer: '_activeChanged',
              notify: true,
          },
          events: {
              type: String,
              value: '[{"title" : "event1", "start" : "2018-04-10T10:00:00", "end" : "2018-04-10T12:30:00"},{"title" : "event2", "start" : "2018-04-11T12:30:00", "end" : "2018-04-11T17:30:00"}]',
              notify: true,
          }
        },

          attached: function() {
              this.rol = this.$.globalvars.data.rol;
              console.log(this.rol + " - " + this._rol);
              console.log('setting URL');
              // Here you would set your URL
          },

          _activeChanged: function(newValue, oldValue) {
              if(newValue) {
                  if(newValue == "rooster")
                  {
                      this.rol=this.$.globalvars.data.rol;
                      this._rol = this.$.globalvars.data.rol;
                      this.identificatienummer = this.$.globalvars.data.leerlingnummer;
                      console.log(this.$.globalvars.data.rol);

                      this.$.ajax_rooster.contentType="application/json";
                      this.$.ajax_rooster.body={
                          "leerlingnummer":this.identificatienummer,
                          "password":this.$.globalvars.data.wachtwoord,
                          "rol":this._rol
                      };
                      this.$.ajax_rooster.generateRequest();
                  }
                  //this.$.getDevices.generateRequest();
              }
          },

        _go_home: function () {
          var lApp = document.querySelector('my-app'); //het polymer element <my-app>
          var lAppRouter = lApp.$.approuter; // het html-element <app-route> met id=approuter
          lAppRouter.data = {
            page: ""
          }; // vul het data attribute met de homepage url
          // door de two way binding in <app-route> en <app-location>
          // zal ook de url echt wijzigen
        },

        _verander_status_aanwezigheid: function() {
          var button = this.$.button_afwezig_melden;
          if(button.textContent == "Aanwezig melden") {
            button.textContent = "Afwezig melden";
            this.$.aanwezigmelding.open();
          }
          else  {
            button.textContent = "Aanwezig melden";
            this.$.afwezigmelding.open();
          }
        },

        _verander_status_gezondheid: function() {
          var button = this.$.button_ziek_melden;
          if(button.textContent == "Beter melden") {
            button.textContent = "Ziek melden";
            this.$.betermelding.open();
          }
          else  {
            button.textContent = "Beter melden";
            this.$.ziekmelding.open();
          }
        },
          _ophalen_rooster_response_handler: function(request) {
              console.log("_ophalen_rooster_response_handler leerlingnummer="+this.identificatienummer);
              console.log(request.detail.response);
          },

        toggleDialog: function () {
          this.$.dialog.toggle();
        }
      });
    })();
  </script>
</dom-module>